parcelRequire=function(e){var t="function"==typeof parcelRequire&&parcelRequire,n="function"==typeof require&&require,o={};function r(e,r){if(e in o)return o[e];var s="function"==typeof parcelRequire&&parcelRequire;if(!r&&s)return s(e,!0);if(t)return t(e,!0);if(n&&"string"==typeof e)return n(e);var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}return r.register=function(e,t){o[e]=t},o=function(e){var t={};class n{constructor(e="keyval-store",t="keyval"){this.storeName=t,this._dbp=new Promise((n,o)=>{const r=indexedDB.open(e,1);r.onerror=(()=>o(r.error)),r.onsuccess=(()=>n(r.result)),r.onupgradeneeded=(()=>{r.result.createObjectStore(t)})})}_withIDBStore(e,t){return this._dbp.then(n=>new Promise((o,r)=>{const s=n.transaction(this.storeName,e);s.oncomplete=(()=>o()),s.onabort=s.onerror=(()=>r(s.error)),t(s.objectStore(this.storeName))}))}}let o;function r(){return o||(o=new n),o}t.keys=function(e=r()){const t=[];return e._withIDBStore("readonly",e=>{(e.openKeyCursor||e.openCursor).call(e).onsuccess=function(){this.result&&(t.push(this.result.key),this.result.continue())}}).then(()=>t)},t.clear=function(e=r()){return e._withIDBStore("readwrite",e=>{e.clear()})},t.del=function(e,t=r()){return t._withIDBStore("readwrite",t=>{t.delete(e)})},t.set=function(e,t,n=r()){return n._withIDBStore("readwrite",n=>{n.put(t,e)})},t.get=function(e,t=r()){let n;return t._withIDBStore("readonly",t=>{n=t.get(e)}).then(()=>n.result)},t.Store=n;var s={};Object.defineProperty(s,"__esModule",{value:!0});var a=function(e){return new i(e.root,e.width)};s.DuplicateDPRScreen=a;class i{constructor(e,t,n=1.5,o=!0){this.root=e,this.width=t,this.aspectRatio=n,this.fillViewport=o,this.resize(),window.addEventListener("resize",()=>this.resize())}detach(){return this.cvs.parentNode&&this.root.removeChild(this.cvs),this}resize(){let e=!1;this.cvs&&!this.cvs.parentNode&&(e=!0),this.cvs&&this.detach();const t=this.aspectRatio,n=window.innerWidth,o=window.innerHeight,r=o>n&&o/n>=t;this.height=r?o*(this.width/n):this.width*t;const s=this.cvs=document.createElement("canvas"),a=s.getContext("2d");if(!a){const e="Could not initiate canvas context!";throw alert(e),new Error(e)}this.ctx=a,s.style.margin="0 auto",s.style.display="block",s.width=this.width,s.height=this.height,this.root.appendChild(s);const i=s.getBoundingClientRect(),c=window.devicePixelRatio||1;this.dpr=c,s.width=i.width*c,s.height=i.height*c,a.scale(c,c),this.fillViewport&&(r?s.style.width="100%":s.style.height="100%");const l=s.parentNode&&"BODY"!==s.parentNode.nodeName?s.parentNode:null;l&&(l.style.margin="0 auto",l.style.display="block"),a.webkitImageSmoothingEnabled=!1,a.msImageSmoothingEnabled=!1,a.mozImageSmoothingEnabled=!1,a.imageSmoothingEnabled=!1,e&&this.detach()}drawFrom(e){this.ctx.drawImage(e.cvs,0,0,e.cvs.width,e.cvs.height,0,0,this.cvs.width/this.dpr,this.cvs.height/this.dpr)}}var c=i;s.DPRScreen=c;"sprites.e6a11595.png";var l={};l={chrome_tl:{x:0,y:0,w:4,h:4},chrome_top:{x:4,y:0,w:1,h:4},ghost_bat:{x:5,y:0,w:32,h:32},ghost_bun:{x:37,y:0,w:32,h:32},ghost_cat:{x:69,y:0,w:32,h:32},ghost_hungry:{x:0,y:32,w:32,h:32},ghost_ink:{x:32,y:32,w:32,h:32},ghost_jaws:{x:64,y:32,w:32,h:32},ghost_petrified:{x:96,y:32,w:32,h:32},ghost_plant:{x:0,y:64,w:32,h:32},ghost_shy:{x:32,y:64,w:32,h:32},loc_abandoned:{x:0,y:96,w:128,h:64},loc_pier:{x:0,y:160,w:128,h:64},loc_street:{x:0,y:224,w:128,h:64},loc_tarot:{x:0,y:288,w:128,h:64},pico8_font:{x:0,y:352,w:128,h:40}};var h={},d=h&&h.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,s){function a(e){try{c(o.next(e))}catch(e){s(e)}}function i(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,i)}c((o=o.apply(e,t||[])).next())})};Object.defineProperty(h,"__esModule",{value:!0});var p=class{constructor(e){this.path=e}colorShift(e,t,n,o){return d(this,void 0,void 0,function*(){const r=document.createElement("canvas");r.width=this.img.width,r.height=this.img.height;const s=r.getContext("2d");s.drawImage(this.img,0,0);const a=s.getImageData(0,0,r.width,r.height),i=a.data;for(var c=0;c<i.length;c+=4)i[c+0]=e,i[c+1]=t,i[c+2]=n,i[c+3]=0!==i[c+3]?o:0;return s.putImageData(a,0,0),new Promise((e,t)=>{this.img.onload=e,this.img.onerror=t,this.img.src=r.toDataURL()})})}load(){return new Promise((e,t)=>{const n=document.createElement("img");n.onload=(()=>e(n)),n.onerror=(e=>t(e)),n.src=this.path}).then(e=>{this.img=e})}};h.SpriteSheet=p;var u,g,w={};Object.defineProperty(w,"__esModule",{value:!0}),m=g=w.SpriteScale||(u={},w.SpriteScale=u),m[m.ONE=1]="ONE",m[m.TWO=2]="TWO",m[m.THREE=3]="THREE",m[m.FOUR=4]="FOUR";var m;var f=class{constructor(e){this.dprScreen=e,this.backbuffer=a(e).detach()}drawImg(e,t,n,o,r,s,a,i=g.ONE){this.dprScreen.ctx.drawImage(e,t,n,o,r,s,a,o*Math.floor(i),r*Math.floor(i))}ghostGlitch(e,t,n,o,r=o/2){this.backbuffer.drawFrom(this.dprScreen);let s=e,a=t,i=n,c=o;const l=Math.floor(r),h=c/l;for(let e=0;e<l;e++){const t=Math.floor(h),n=Math.floor(Math.random()*i)||1,o=Math.floor(Math.random()*(i-n)),r=Math.floor(Math.random()*n-n),c=Math.floor(s+o),l=Math.floor(a+e*t),d=Math.floor(s+r),p=Math.floor(a+e*t);this.dprScreen.ctx.drawImage(this.backbuffer.cvs,c,l,n,t,d,p,n,t)}}};w.SpriteScreen=f;var y,v={},S=v&&v.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(v,"__esModule",{value:!0});const _=S("sprites.e6a11595.png"),b=S(l),x=4,O=5,M=16,I=b.pico8_font;var P;E=P=y||(y={},v.FontColor=y),E[E.WHITE=0]="WHITE",E[E.BLACK=1]="BLACK";var E;var T=class{constructor(e){this.sscreen=e,this.white=new h.SpriteSheet(_.default),this.black=new h.SpriteSheet(_.default)}load(){return Promise.all([this.white.load(),this.black.load()]).then(()=>this.black.colorShift(0,0,0,255))}measure(e,t=w.SpriteScale.ONE){const n=this.drawText(0,0,e,t,P.BLACK,!0);return n}drawText(e,t,n,o=w.SpriteScale.ONE,r=P.BLACK,s=!1){let a=e,i=t;for(let e=0;e<n.length;e++){const t=n.charCodeAt(e);let c=x;const l=(t>=65&&t<=90?t+32:t>=97&&t<=122?t-32:t)-32;t>=128&&(c=2*x);const h=Math.floor(l/M),d=l%M,p=r===P.WHITE?this.white.img:this.black.img;s||this.sscreen.drawImg(p,I.x+d*(2*x),I.y+h*O,2*x,O,a,i,o),a+=c*o}return{w:a-e,h:(O+1)*o}}};v.PicoFont=T;var B={},D=B&&B.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,s){function a(e){try{c(o.next(e))}catch(e){s(e)}}function i(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,i)}c((o=o.apply(e,t||[])).next())})},A=B&&B.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(B,"__esModule",{value:!0});const R=A("sprites.e6a11595.png"),W=A(l),k=new Map;k.set(W.ghost_bun,{name:"BUNNY GHOST",problem:["I'm so fluffy and cuddly,","no one will ever be scared","of me!"],answers:["Hug it","Love it","Yell at it","Back slowly away from it"],correct:3,responses:{right:["I scared you!?","AMAZING WILL YOU BE MY FRIEND?"],wrong:["Ugh please don't touch me."]}}),k.set(W.ghost_bat,{name:"",problem:[],answers:[],correct:-1,responses:{right:[""],wrong:[""]}}),k.set(W.ghost_cat,{name:"",problem:[],answers:[],correct:-1,responses:{right:[""],wrong:[""]}}),k.set(W.ghost_hungry,{name:"",problem:[],answers:[],correct:-1,responses:{right:[""],wrong:[""]}}),k.set(W.ghost_ink,{name:"INKY GHOST",problem:["Everywhere I go I leave","a trail!","I'll never scare anyone","like this..."],answers:["High five it","Give it a pen","Poke it","Give it some paper"],correct:1,responses:{right:["Now I can write scary letters!","Will you be my friend?"],wrong:["Sigh. Follow the trail when","you think of something better."]}}),k.set(W.ghost_jaws,{name:"",problem:[],answers:[],correct:-1,responses:{right:[""],wrong:[""]}}),k.set(W.ghost_petrified,{name:"",problem:[],answers:[],correct:-1,responses:{right:[""],wrong:[""]}}),k.set(W.ghost_plant,{name:"SPROUTY SPIRIT",problem:["I was taken from my forest","and I really miss my garden."],answers:["Water it","Coax it into the sun","Give it a pot",'Say, "I\'m sorry"'],correct:2,responses:{right:["I can grow things with you!","YOUR HOME WILL BE MY FOREST!"],wrong:["My plant love is wasted..."]}}),k.set(W.ghost_shy,{name:"",problem:[],answers:[],correct:-1,responses:{right:[""],wrong:[""]}});const j={cols:4,rows:3,cells:[{ghost:W.ghost_bun,location:W.loc_pier},{ghost:null,location:W.loc_pier},{ghost:W.ghost_ink,location:W.loc_street},{ghost:null,location:W.loc_tarot},{ghost:W.ghost_plant,location:W.loc_abandoned},{ghost:null,location:W.loc_abandoned},{ghost:null,location:W.loc_pier},{ghost:null,location:W.loc_pier},{ghost:null,location:W.loc_abandoned},{ghost:null,location:W.loc_abandoned},{ghost:null,location:W.loc_pier},{ghost:null,location:W.loc_pier}]},N={x:0,y:0,flash:0,flashInterval:500},Y={panels:[],tapActions:[],sincePrevTap:0,tapZones:[],player:{geo:null,cell:null,saveData:{solvedLocations:[]}}};const C=function(){const e=Math.PI/360;return function(t,n,o,r){const s=Math.cos((t+o)*e),a=(o-t)*e,i=(r-n)*e,c=a*a+s*s*i*i,l=2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c));return 6378137*l}}();function L(e,t,n,o){const r=W.chrome_tl.w*w.SpriteScale.TWO,s=2*n.measure(" ",w.SpriteScale.TWO).h,a=Array.isArray(t.content)?t.content.map(e=>n.measure(e,w.SpriteScale.TWO)).reduce((e,t)=>(e.w=Math.max(t.w,e.w),e.h+=t.h,e),{w:0,h:0}):{w:t.content.desc.w*t.content.scale,h:t.content.desc.h*t.content.scale},i=Math.min(a.w+(t.noBorder?0:2*r),o.dprScreen.width),c=Math.min(Math.max(a.h,s)+(t.noBorder?0:2*r),o.dprScreen.height);let l,h;return void 0===t.computedX?(l=Math.floor((o.dprScreen.width-i)*Math.random()),t.computedX=l):l=t.computedX,void 0===t.computedY?(h=t.resetY?0:Math.max(e-Math.floor(c/2*Math.random()),0),t.computedY=h):h=t.computedY,{w:i,h:c,padding:r,x:l,y:h}}const F="lgsavedata";(function(){D(this,void 0,void 0,function*(){const e=new c(document.body,256),n=new w.SpriteScreen(e),o=new h.SpriteSheet(R.default),r=new T(n);let s=0;const a={running:!0,stop:()=>{a.running=!1},anim:()=>{a.running&&(s+=16,Y.sincePrevTap=Math.max(Y.sincePrevTap-16,0),Y.panels.forEach((e,t)=>{const n=t===Y.panels.length-1;e.action&&n&&e.action(e,s),e.icon&&n&&(e.icon.flash-=16,e.icon.flash<0&&(e.icon.flash=e.icon.flashInterval))}),n.dprScreen.ctx.fillStyle="black",n.dprScreen.ctx.fillRect(0,0,n.dprScreen.width,n.dprScreen.height),function(e,t,n,o){let r=0;n.measure(" ",w.SpriteScale.TWO).h;for(let s=0;s<o.length;s++){const a=o[s],i=L(r,a,n,e),{w:c,h:l,x:h,y:d,padding:p}=i,{ctx:u}=e.dprScreen;a.noDimPrev||(u.fillStyle="rgba(0, 0, 0, 0.3)",u.fillRect(0,0,e.dprScreen.width,e.dprScreen.height));const g=h+(a.noBorder?0:p),m=d+(a.noBorder?0:p),f=c-(a.noBorder?0:2*p),v=l-(a.noBorder?0:2*p);if(u.fillStyle="blue",u.fillRect(h,d,c,l),!a.noBorder){const n=W.chrome_tl,o=W.chrome_top;u.save(),u.translate(0,0),u.rotate(0),u.drawImage(t.img,o.x,o.y,o.w,o.h,h,d,c,o.h*w.SpriteScale.TWO),u.restore(),u.save(),u.translate(h+c,d),u.rotate(Math.PI/2),u.drawImage(t.img,o.x,o.y,o.w,o.h,0,0,l,o.h*w.SpriteScale.TWO),u.restore(),u.save(),u.translate(h+c,d+l),u.rotate(Math.PI),u.drawImage(t.img,o.x,o.y,o.w,o.h,0,0,c,o.h*w.SpriteScale.TWO),u.restore(),u.save(),u.translate(h,d+l),u.rotate(-Math.PI/2),u.drawImage(t.img,o.x,o.y,o.w,o.h,0,0,l,o.h*w.SpriteScale.TWO),u.restore(),e.drawImg(t.img,n.x,n.y,n.w,n.h,h,d,w.SpriteScale.TWO),u.save(),u.translate(h+c,d),u.scale(-1,1),e.drawImg(t.img,n.x,n.y,n.w,n.h,0,0,w.SpriteScale.TWO),u.restore(),u.save(),u.translate(h+c,d+l),u.scale(-1,-1),e.drawImg(t.img,n.x,n.y,n.w,n.h,0,0,w.SpriteScale.TWO),u.restore(),u.save(),u.translate(h,d+l),u.scale(1,-1),e.drawImg(t.img,n.x,n.y,n.w,n.h,0,0,w.SpriteScale.TWO),u.restore()}if(u.fillStyle="blue",u.fillRect(g,m,f,v),Array.isArray(a.content)){let e=0;a.content.forEach(t=>{n.drawText(h+(a.noBorder?0:p),d+e+(a.noBorder?0:p),t,w.SpriteScale.TWO,y.WHITE),e+=n.measure(t,w.SpriteScale.TWO).h})}else{const{desc:t,scale:n}=a.content;e.drawImg(a.content.img,t.x,t.y,t.w,t.h,h+(a.noBorder?0:p),d+(a.noBorder?0:p),n)}if(a.ghostEffect){const t=f/5,n=v/2,o=g+f/4,r=m+v/4;e.ghostGlitch(o,r,t,n,8)}a.drawAction&&a.drawAction(a,i,e,0),r=d+l,a.icon&&a.icon.flash<=a.icon.flashInterval/2&&n.drawText(h+c-4*p,d+l-p,a.icon.content||"",w.SpriteScale.FOUR,y.WHITE)}}(n,o,r,Y.panels),requestAnimationFrame(a.anim))}};let i;a.anim(),document.addEventListener("keydown",e=>{"Escape"===e.key&&(a.stop(),console.log("stopped"))}),yield Promise.all([o.load(),r.load()]),Y.panels.push({content:["Loaded immaterial photograms!"]}),Y.panels.push({content:["Retrieving past lives..."]}),yield function(e){return D(this,void 0,void 0,function*(){const n=yield t.get(F);n&&(e.player.saveData=n)})}(Y),console.log("loaded save data",Y.player.saveData),Y.panels.push({content:["OK!"]}),Y.panels.push({content:["Acquiring spectral...","triangulation!"],icon:Object.assign({},N,{content:""}),action:(e,t)=>{const n=t%300;e.icon.content=n<100?"":n>=100&&n<200?"":""}});try{i=yield function(){return D(this,void 0,void 0,function*(){const e=window.location.search.slice(1).split("&").reduce((e,t)=>{const[n,o]=t.split("=");return e.set(n,o),e},new Map),[t,n]=[parseFloat(e.get("lat")),parseFloat(e.get("lng"))];return new Promise((e,o)=>{if(t&&n)return e({coords:{latitude:t,longitude:n,accuracy:0,altitude:null,altitudeAccuracy:null,heading:null,speed:null},timestamp:Date.now()});navigator.geolocation.getCurrentPosition(e,o,{enableHighAccuracy:!0,timeout:3e4,maximumAge:1e4})})})}()}catch(e){return void Y.panels.push({content:["Failed to acquire! Sorry."]})}if(Y.player.geo=i,function(e,t){const n=20*e.cols,o=20*e.rows;if(!t.geo)return;const r={lng:0,lat:0},s=C(r.lat,r.lng,t.geo.coords.latitude,t.geo.coords.longitude),a=function(e,t,n,o){var r=Math.sin(o-t)*Math.cos(n),s=Math.cos(e)*Math.sin(n)-Math.sin(e)*Math.cos(n)*Math.cos(o-t);return Math.atan2(r,s)}(r.lat,r.lng,t.geo.coords.latitude,t.geo.coords.longitude),i=Math.cos(a)*s,c=Math.sin(a)*s,l=i%n,h=c%o,d=l<0?n+l:l,p=h<0?o+h:h,u=Math.floor(d/n*e.cols),g=Math.floor(p/o*e.rows)*e.cols+u;t.cell=g}(j,Y.player),null!==Y.player.cell){Y.panels.push({content:["Acquired!"],noDimPrev:!0});const e={content:{desc:{x:0,y:0,w:64,h:64},img:new Image,scale:w.SpriteScale.TWO},icon:Object.assign({},N),drawAction:(e,t,n)=>{const{ctx:o}=n.dprScreen,r=Math.floor(Y.player.cell/j.cols),s=Y.player.cell%j.cols;for(let e=0;e<j.rows;e++)for(let n=0;n<j.cols;n++)o.fillStyle="pink",o.fillRect(t.x+t.padding+8*n,t.y+t.padding+8*e,6,6),e===r&&n===s&&(o.fillStyle="yellow",o.fillRect(t.x+t.padding+8*n,t.y+t.padding+8*e,6,6))}};Y.panels.push({content:[Y.player.geo.coords.latitude+", ",Y.player.geo.coords.longitude+""],icon:Object.assign({},N)}),Y.tapActions.push(()=>{Y.panels.push(e)});const t=j.cells[Y.player.cell],s=Y.player.saveData.solvedLocations.find(e=>e===Y.player.cell),a={content:{desc:t.location,img:o.img,scale:w.SpriteScale.TWO},noBorder:!0,resetY:!0,icon:Object.assign({},N,{content:s?void 0:"!?"})};if(Y.tapActions.push(()=>{Y.panels.push(a)}),s)Y.tapActions.push(()=>{Y.panels.push({content:["Back here again..."],noDimPrev:!0,icon:Object.assign({},N)})},()=>{Y.panels.push({content:["I don't see any ghosts around"],noDimPrev:!0,icon:Object.assign({},N)})});else if(t.ghost){a.ghostEffect=!0;const e=k.get(t.ghost);console.log(e),Y.tapActions.push(()=>{Y.panels.push({content:[" Ahh! A ghost!"],noDimPrev:!0,icon:Object.assign({},N)})},()=>{Y.panels.push({content:["It has something to say..."],noDimPrev:!0,icon:Object.assign({},N)})},()=>Y.panels.push({content:e.problem,noDimPrev:!0,icon:Object.assign({},N)}),()=>{const s=Y.panels[Y.panels.length-1];if(!s)return;const a=L(s.computedY,s,r,n);let i=a.y+a.h+a.padding;e.answers.forEach((s,a)=>{const c={content:[" "+s],noDimPrev:!0,computedX:r.measure(" ",w.SpriteScale.TWO).w,computedY:i},l=L(i,c,r,n);i+=l.h,Y.panels.push(c),Y.tapZones.push({x:l.x,y:l.y,w:l.w,h:l.h,action:n=>{Y.tapZones.length=0,a===e.correct?(Y.panels.push({content:{desc:t.ghost,img:o.img,scale:w.SpriteScale.FOUR},resetY:!0,icon:Object.assign({},N)}),Y.tapActions.push(()=>Y.panels.push({content:e.responses.right,noDimPrev:!0,icon:Object.assign({},N)}),()=>Y.panels.push({content:["You helped "+e.name+"!"],noDimPrev:!0,icon:Object.assign({},N)}),()=>Y.panels.push({content:["And you continued on."],noDimPrev:!0,icon:Object.assign({},N)}),()=>window.location.reload())):(Y.panels.push({content:[""],noBorder:!0}),Y.panels.push({content:[""],noBorder:!0}),Y.panels.push({content:[""],noBorder:!0}),Y.panels.push({content:[""],noBorder:!0}),Y.panels.push({content:e.responses.wrong,resetY:!0,icon:Object.assign({},N)}),Y.tapActions.push(()=>window.location.reload()))}})})})}else Y.tapActions.push(()=>{Y.panels.push({content:["I don't see any ghosts around"],noDimPrev:!0,icon:Object.assign({},N)})})}const l=e=>{if(Y.sincePrevTap>0)return;if(Y.sincePrevTap=500,Y.tapZones.length){const t=Y.tapZones.findIndex(t=>e.x>t.x&&e.y>t.y&&e.x<t.x+t.w&&e.y<t.y+t.h);if(-1===t)return;const n=Y.tapZones.splice(t,1)[0];return void n.action(n)}const t=Y.tapActions.shift();t&&t()};n.dprScreen.cvs.addEventListener("touchstart",t=>{const n=t.touches[0],o=n.target.getBoundingClientRect().width/e.width,r={x:n.clientX/o,y:n.clientY/o};l(r)}),n.dprScreen.cvs.addEventListener("click",t=>{const n=t.target.getBoundingClientRect().width/e.width,o={x:t.offsetX/n,y:t.offsetY/n};l(o)})})})(),document.addEventListener("touchmove",function(e){e.preventDefault()},{passive:!1}),"object"==typeof exports&&"undefined"!=typeof module?module.exports=B:"function"==typeof define&&define.amd&&define(function(){return B});return{"9B6d":B}}(),r.modules=o,r}();