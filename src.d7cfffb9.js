parcelRequire=function(e){var t="function"==typeof parcelRequire&&parcelRequire,n="function"==typeof require&&require,o={};function r(e,r){if(e in o)return o[e];var s="function"==typeof parcelRequire&&parcelRequire;if(!r&&s)return s(e,!0);if(t)return t(e,!0);if(n&&"string"==typeof e)return n(e);var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}return r.register=function(e,t){o[e]=t},o=function(e){var t={};class n{constructor(e="keyval-store",t="keyval"){this.storeName=t,this._dbp=new Promise((n,o)=>{const r=indexedDB.open(e,1);r.onerror=(()=>o(r.error)),r.onsuccess=(()=>n(r.result)),r.onupgradeneeded=(()=>{r.result.createObjectStore(t)})})}_withIDBStore(e,t){return this._dbp.then(n=>new Promise((o,r)=>{const s=n.transaction(this.storeName,e);s.oncomplete=(()=>o()),s.onabort=s.onerror=(()=>r(s.error)),t(s.objectStore(this.storeName))}))}}let o;function r(){return o||(o=new n),o}t.keys=function(e=r()){const t=[];return e._withIDBStore("readonly",e=>{(e.openKeyCursor||e.openCursor).call(e).onsuccess=function(){this.result&&(t.push(this.result.key),this.result.continue())}}).then(()=>t)},t.clear=function(e=r()){return e._withIDBStore("readwrite",e=>{e.clear()})},t.del=function(e,t=r()){return t._withIDBStore("readwrite",t=>{t.delete(e)})},t.set=function(e,t,n=r()){return n._withIDBStore("readwrite",n=>{n.put(t,e)})},t.get=function(e,t=r()){let n;return t._withIDBStore("readonly",t=>{n=t.get(e)}).then(()=>n.result)},t.Store=n;var s={};Object.defineProperty(s,"__esModule",{value:!0});var i=function(e){return new a(e.root,e.width)};s.DuplicateDPRScreen=i;class a{constructor(e,t,n=1.5,o=!0){this.root=e,this.width=t,this.aspectRatio=n,this.fillViewport=o,this.resize(),window.addEventListener("resize",()=>this.resize())}detach(){return this.cvs.parentNode&&this.root.removeChild(this.cvs),this}resize(){let e=!1;this.cvs&&!this.cvs.parentNode&&(e=!0),this.cvs&&this.detach();const t=this.aspectRatio,n=window.innerWidth,o=window.innerHeight,r=o>n&&o/n>=t;this.height=r?o*(this.width/n):this.width*t;const s=this.cvs=document.createElement("canvas"),i=s.getContext("2d");if(!i){const e="Could not initiate canvas context!";throw alert(e),new Error(e)}this.ctx=i,s.style.margin="0 auto",s.style.display="block",s.width=this.width,s.height=this.height,this.root.appendChild(s);const a=s.getBoundingClientRect(),c=window.devicePixelRatio||1;this.dpr=c,s.width=a.width*c,s.height=a.height*c,i.scale(c,c),this.fillViewport&&(r?s.style.width="100%":s.style.height="100%");const l=s.parentNode&&"BODY"!==s.parentNode.nodeName?s.parentNode:null;l&&(l.style.margin="0 auto",l.style.display="block"),i.webkitImageSmoothingEnabled=!1,i.msImageSmoothingEnabled=!1,i.mozImageSmoothingEnabled=!1,i.imageSmoothingEnabled=!1,e&&this.detach()}drawFrom(e){this.ctx.drawImage(e.cvs,0,0,e.cvs.width,e.cvs.height,0,0,this.cvs.width/this.dpr,this.cvs.height/this.dpr)}}var c=a;s.DPRScreen=c;"sprites.c676f48f.png";var l={};l={chrome_tl:{x:0,y:0,w:4,h:4},chrome_top:{x:4,y:0,w:1,h:4},ghost_bat:{x:5,y:0,w:32,h:32},ghost_bun:{x:37,y:0,w:32,h:32},ghost_cat:{x:69,y:0,w:32,h:32},ghost_hungry:{x:0,y:32,w:32,h:32},ghost_ink:{x:32,y:32,w:32,h:32},ghost_jaws:{x:64,y:32,w:32,h:32},ghost_petrified:{x:96,y:32,w:32,h:32},ghost_plant:{x:0,y:64,w:32,h:32},ghost_shy:{x:32,y:64,w:32,h:32},loc_abandoned:{x:0,y:96,w:128,h:64},loc_pier:{x:0,y:160,w:128,h:64},loc_street:{x:0,y:224,w:128,h:64},loc_tarot:{x:0,y:288,w:128,h:64},pico8_font:{x:0,y:352,w:128,h:40}};var h={},d=h&&h.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,s){function i(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(i,a)}c((o=o.apply(e,t||[])).next())})};Object.defineProperty(h,"__esModule",{value:!0});var p=class{constructor(e){this.path=e}colorShift(e,t,n,o){return d(this,void 0,void 0,function*(){const r=document.createElement("canvas");r.width=this.img.width,r.height=this.img.height;const s=r.getContext("2d");s.drawImage(this.img,0,0);const i=s.getImageData(0,0,r.width,r.height),a=i.data;for(var c=0;c<a.length;c+=4)a[c+0]=e,a[c+1]=t,a[c+2]=n,a[c+3]=0!==a[c+3]?o:0;return s.putImageData(i,0,0),new Promise((e,t)=>{this.img.onload=e,this.img.onerror=t,this.img.src=r.toDataURL()})})}load(){return new Promise((e,t)=>{const n=document.createElement("img");n.onload=(()=>e(n)),n.onerror=(e=>t(e)),n.src=this.path}).then(e=>{this.img=e})}};h.SpriteSheet=p;var u,g,w={};Object.defineProperty(w,"__esModule",{value:!0}),m=g=w.SpriteScale||(u={},w.SpriteScale=u),m[m.ONE=1]="ONE",m[m.TWO=2]="TWO",m[m.THREE=3]="THREE",m[m.FOUR=4]="FOUR";var m;var f=class{constructor(e){this.dprScreen=e,this.backbuffer=i(e).detach()}drawImg(e,t,n,o,r,s,i,a=g.ONE){this.dprScreen.ctx.drawImage(e,t,n,o,r,s,i,o*Math.floor(a),r*Math.floor(a))}ghostGlitch(e,t,n,o,r=o/2){this.backbuffer.drawFrom(this.dprScreen);let s=e,i=t,a=n,c=o;const l=Math.floor(r),h=c/l;for(let e=0;e<l;e++){const t=Math.floor(h),n=Math.floor(Math.random()*a)||1,o=Math.floor(Math.random()*(a-n)),r=Math.floor(Math.random()*n-n),c=Math.floor(s+o),l=Math.floor(i+e*t),d=Math.floor(s+r),p=Math.floor(i+e*t);this.dprScreen.ctx.drawImage(this.backbuffer.cvs,c,l,n,t,d,p,n,t)}}};w.SpriteScreen=f;var y,v={},S=v&&v.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(v,"__esModule",{value:!0});const b=S("sprites.c676f48f.png"),x=S(l),_=4,O=5,I=16,M=x.pico8_font;var P;E=P=y||(y={},v.FontColor=y),E[E.WHITE=0]="WHITE",E[E.BLACK=1]="BLACK";var E;var T=class{constructor(e){this.sscreen=e,this.white=new h.SpriteSheet(b.default),this.black=new h.SpriteSheet(b.default)}load(){return Promise.all([this.white.load(),this.black.load()]).then(()=>this.black.colorShift(0,0,0,255))}measure(e,t=w.SpriteScale.ONE){const n=this.drawText(0,0,e,t,P.BLACK,!0);return n}drawText(e,t,n,o=w.SpriteScale.ONE,r=P.BLACK,s=!1){let i=e,a=t;for(let e=0;e<n.length;e++){const t=n.charCodeAt(e);let c=_;const l=(t>=65&&t<=90?t+32:t>=97&&t<=122?t-32:t)-32;t>=128&&(c=2*_);const h=Math.floor(l/I),d=l%I,p=r===P.WHITE?this.white.img:this.black.img;s||this.sscreen.drawImg(p,M.x+d*(2*_),M.y+h*O,2*_,O,i,a,o),i+=c*o}return{w:i-e,h:(O+1)*o}}};v.PicoFont=T;var B={},D=B&&B.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,s){function i(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(i,a)}c((o=o.apply(e,t||[])).next())})},R=B&&B.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(B,"__esModule",{value:!0});const W=R("sprites.c676f48f.png"),k=R(l),A=new Map;A.set(k.ghost_bun,{name:"BUNNY GHOST",problem:["I'm so fluffy and cuddly,","no one will ever be scared","of me!"],answers:["Hug it","Love it","Yell at it","Back slowly away from it"],correct:3,responses:{right:["I scared you!?","AMAZING WILL YOU BE MY FRIEND?"],wrong:["Ugh please don't touch me."]}}),A.set(k.ghost_bat,{name:"",problem:[],answers:[],correct:-1,responses:{right:[""],wrong:[""]}}),A.set(k.ghost_cat,{name:"",problem:[],answers:[],correct:-1,responses:{right:[""],wrong:[""]}}),A.set(k.ghost_hungry,{name:"",problem:[],answers:[],correct:-1,responses:{right:[""],wrong:[""]}}),A.set(k.ghost_ink,{name:"INKY GHOST",problem:["Everywhere I go I leave","a trail!","I'll never scare anyone","like this..."],answers:["High five it","Give it a pen","Poke it","Give it some paper"],correct:1,responses:{right:["Now I can write scary letters!","Will you be my friend?"],wrong:["Sigh. Follow the trail when","you think of something better."]}}),A.set(k.ghost_jaws,{name:"",problem:[],answers:[],correct:-1,responses:{right:[""],wrong:[""]}}),A.set(k.ghost_petrified,{name:"",problem:[],answers:[],correct:-1,responses:{right:[""],wrong:[""]}}),A.set(k.ghost_plant,{name:"SPROUTY SPIRIT",problem:["I was taken from my forest","and I really miss my garden."],answers:["Water it","Coax it into the sun","Give it a pot",'Say, "I\'m sorry"'],correct:2,responses:{right:["I can grow things with you!","YOUR HOME WILL BE MY FOREST!"],wrong:["My plant love is wasted..."]}}),A.set(k.ghost_shy,{name:"",problem:[],answers:[],correct:-1,responses:{right:[""],wrong:[""]}});const j={cols:1,rows:1,cells:[{ghost:k.ghost_bun,location:k.loc_pier}]},N={x:0,y:0,flash:0,flashInterval:500},Y={panels:[],tapActions:[],sincePrevTap:0,tapZones:[],player:{geo:null,cell:null,saveData:{solvedLocations:[]}}};function C(e,t,n,o){const r=k.chrome_tl.w*w.SpriteScale.TWO,s=2*n.measure(" ",w.SpriteScale.TWO).h,i=Array.isArray(t.content)?t.content.map(e=>n.measure(e,w.SpriteScale.TWO)).reduce((e,t)=>(e.w=Math.max(t.w,e.w),e.h+=t.h,e),{w:0,h:0}):{w:t.content.desc.w*t.content.scale,h:t.content.desc.h*t.content.scale},a=Math.min(i.w+(t.noBorder?0:2*r),o.dprScreen.width),c=Math.min(Math.max(i.h,s)+(t.noBorder?0:2*r),o.dprScreen.height);let l,h;return void 0===t.computedX?(l=Math.floor((o.dprScreen.width-a)*Math.random()),t.computedX=l):l=t.computedX,void 0===t.computedY?(h=t.resetY?0:Math.max(e-Math.floor(c/2*Math.random()),0),t.computedY=h):h=t.computedY,{w:a,h:c,padding:r,x:l,y:h}}const L="lgsavedata";(function(){D(this,void 0,void 0,function*(){const e=new c(document.body,256),n=new w.SpriteScreen(e),o=new h.SpriteSheet(W.default),r=new T(n);let s=0;const i={running:!0,stop:()=>{i.running=!1},anim:()=>{i.running&&(s+=16,Y.sincePrevTap=Math.max(Y.sincePrevTap-16,0),Y.panels.forEach((e,t)=>{const n=t===Y.panels.length-1;e.action&&n&&e.action(e,s),e.icon&&n&&(e.icon.flash-=16,e.icon.flash<0&&(e.icon.flash=e.icon.flashInterval))}),n.dprScreen.ctx.fillStyle="black",n.dprScreen.ctx.fillRect(0,0,n.dprScreen.width,n.dprScreen.height),function(e,t,n,o){let r=0;n.measure(" ",w.SpriteScale.TWO).h;for(let s=0;s<o.length;s++){const i=o[s],a=C(r,i,n,e),{w:c,h:l,x:h,y:d,padding:p}=a,{ctx:u}=e.dprScreen;i.noDimPrev||(u.fillStyle="rgba(0, 0, 0, 0.3)",u.fillRect(0,0,e.dprScreen.width,e.dprScreen.height));const g=h+(i.noBorder?0:p),m=d+(i.noBorder?0:p),f=c-(i.noBorder?0:2*p),v=l-(i.noBorder?0:2*p);if(u.fillStyle="blue",u.fillRect(h,d,c,l),!i.noBorder){const n=k.chrome_tl,o=k.chrome_top;u.save(),u.translate(0,0),u.rotate(0),u.drawImage(t.img,o.x,o.y,o.w,o.h,h,d,c,o.h*w.SpriteScale.TWO),u.restore(),u.save(),u.translate(h+c,d),u.rotate(Math.PI/2),u.drawImage(t.img,o.x,o.y,o.w,o.h,0,0,l,o.h*w.SpriteScale.TWO),u.restore(),u.save(),u.translate(h+c,d+l),u.rotate(Math.PI),u.drawImage(t.img,o.x,o.y,o.w,o.h,0,0,c,o.h*w.SpriteScale.TWO),u.restore(),u.save(),u.translate(h,d+l),u.rotate(-Math.PI/2),u.drawImage(t.img,o.x,o.y,o.w,o.h,0,0,l,o.h*w.SpriteScale.TWO),u.restore(),e.drawImg(t.img,n.x,n.y,n.w,n.h,h,d,w.SpriteScale.TWO),u.save(),u.translate(h+c,d),u.scale(-1,1),e.drawImg(t.img,n.x,n.y,n.w,n.h,0,0,w.SpriteScale.TWO),u.restore(),u.save(),u.translate(h+c,d+l),u.scale(-1,-1),e.drawImg(t.img,n.x,n.y,n.w,n.h,0,0,w.SpriteScale.TWO),u.restore(),u.save(),u.translate(h,d+l),u.scale(1,-1),e.drawImg(t.img,n.x,n.y,n.w,n.h,0,0,w.SpriteScale.TWO),u.restore()}if(u.fillStyle="blue",u.fillRect(g,m,f,v),Array.isArray(i.content)){let e=0;i.content.forEach(t=>{n.drawText(h+(i.noBorder?0:p),d+e+(i.noBorder?0:p),t,w.SpriteScale.TWO,y.WHITE),e+=n.measure(t,w.SpriteScale.TWO).h})}else{const{desc:t,scale:n}=i.content;e.drawImg(i.content.img,t.x,t.y,t.w,t.h,h+(i.noBorder?0:p),d+(i.noBorder?0:p),n)}if(i.ghostEffect){const t=f/5,n=v/2,o=g+f/4,r=m+v/4;e.ghostGlitch(o,r,t,n,8)}r=d+l,i.icon&&i.icon.flash<=i.icon.flashInterval/2&&n.drawText(h+c-4*p,d+l-p,i.icon.content||"",w.SpriteScale.FOUR,y.WHITE)}}(n,o,r,Y.panels),requestAnimationFrame(i.anim))}};let a;i.anim(),document.addEventListener("keydown",e=>{"Escape"===e.key&&(i.stop(),console.log("stopped"))}),yield Promise.all([o.load(),r.load()]),Y.panels.push({content:["Loaded immaterial photograms!"]}),Y.panels.push({content:["Retrieving past lives..."]}),yield function(e){return D(this,void 0,void 0,function*(){const n=yield t.get(L);n&&(e.player.saveData=n)})}(Y),console.log("loaded save data",Y.player.saveData),Y.panels.push({content:["OK!"]}),Y.panels.push({content:["Acquiring spectral...","triangulation!"],icon:Object.assign({},N,{content:""}),action:(e,t)=>{const n=t%300;e.icon.content=n<100?"":n>=100&&n<200?"":""}});try{a=yield function(){return D(this,void 0,void 0,function*(){return new Promise((e,t)=>{navigator.geolocation.getCurrentPosition(e,t,{enableHighAccuracy:!0,timeout:3e4,maximumAge:1e4})})})}()}catch(e){return void Y.panels.push({content:["Failed to acquire! Sorry."]})}if(Y.player.geo=a,function(e,t){const n=20*e.cols,o=20*e.rows;if(!t.geo)return;const r=n*(180+t.geo.coords.longitude)/360,s=o*(90-t.geo.coords.latitude)/180,i=Math.floor(r/n*e.cols),a=Math.floor(s/o*e.rows)*e.cols+i;t.cell=a}(j,Y.player),null!==Y.player.cell){Y.panels.push({content:["Acquired!"],noDimPrev:!0});const e=j.cells[Y.player.cell],t=Y.player.saveData.solvedLocations.find(e=>e===Y.player.cell),s={content:{desc:e.location,img:o.img,scale:w.SpriteScale.TWO},noBorder:!0,resetY:!0,icon:Object.assign({},N,{content:t?void 0:"!?"})};if(Y.panels.push(s),t)Y.tapActions.push(()=>{Y.panels.push({content:[" Back here again..."],noDimPrev:!0,icon:Object.assign({},N)})},()=>{Y.panels.push({content:[" I don't see any ghosts around"],noDimPrev:!0,icon:Object.assign({},N)})});else{s.ghostEffect=!0;const t=A.get(e.ghost);console.log(t),Y.tapActions.push(()=>{Y.panels.push({content:[" Ahh! A ghost!"],noDimPrev:!0,icon:Object.assign({},N)})},()=>{Y.panels.push({content:["It has something to say..."],noDimPrev:!0,icon:Object.assign({},N)})},()=>Y.panels.push({content:t.problem,noDimPrev:!0,icon:Object.assign({},N)}),()=>{const s=Y.panels[Y.panels.length-1];if(!s)return;const i=C(s.computedY,s,r,n);let a=i.y+i.h+i.padding;t.answers.forEach((s,i)=>{const c={content:[" "+s],noDimPrev:!0,computedX:r.measure(" ",w.SpriteScale.TWO).w,computedY:a},l=C(a,c,r,n);a+=l.h,Y.panels.push(c),Y.tapZones.push({x:l.x,y:l.y,w:l.w,h:l.h,action:n=>{Y.tapZones.length=0,i===t.correct?(Y.panels.push({content:{desc:e.ghost,img:o.img,scale:w.SpriteScale.FOUR},resetY:!0,icon:Object.assign({},N)}),Y.tapActions.push(()=>Y.panels.push({content:t.responses.right,noDimPrev:!0,icon:Object.assign({},N)}),()=>Y.panels.push({content:["You helped "+t.name+"!"],noDimPrev:!0,icon:Object.assign({},N)}),()=>Y.panels.push({content:["And you continued on."],noDimPrev:!0,icon:Object.assign({},N)}),()=>window.location.reload())):(Y.panels.push({content:[""],noBorder:!0}),Y.panels.push({content:[""],noBorder:!0}),Y.panels.push({content:[""],noBorder:!0}),Y.panels.push({content:[""],noBorder:!0}),Y.panels.push({content:t.responses.wrong,resetY:!0,icon:Object.assign({},N)}),Y.tapActions.push(()=>window.location.reload()))}})})})}}const l=e=>{if(Y.sincePrevTap>0)return;if(Y.sincePrevTap=500,Y.tapZones.length){const t=Y.tapZones.findIndex(t=>e.x>t.x&&e.y>t.y&&e.x<t.x+t.w&&e.y<t.y+t.h);if(-1===t)return;const n=Y.tapZones.splice(t,1)[0];return void n.action(n)}const t=Y.tapActions.shift();t&&t()};n.dprScreen.cvs.addEventListener("touchstart",t=>{const n=t.touches[0],o=n.target.getBoundingClientRect().width/e.width,r={x:n.clientX/o,y:n.clientY/o};l(r)}),n.dprScreen.cvs.addEventListener("click",t=>{const n=t.target.getBoundingClientRect().width/e.width,o={x:t.offsetX/n,y:t.offsetY/n};l(o)})})})(),document.addEventListener("touchmove",function(e){e.preventDefault()},{passive:!1}),"object"==typeof exports&&"undefined"!=typeof module?module.exports=B:"function"==typeof define&&define.amd&&define(function(){return B});return{"9B6d":B}}(),r.modules=o,r}();