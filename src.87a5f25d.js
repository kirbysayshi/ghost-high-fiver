parcelRequire=function(e){var t="function"==typeof parcelRequire&&parcelRequire,n="function"==typeof require&&require,o={};function r(e,r){if(e in o)return o[e];var i="function"==typeof parcelRequire&&parcelRequire;if(!r&&i)return i(e,!0);if(t)return t(e,!0);if(n&&"string"==typeof e)return n(e);var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}return r.register=function(e,t){o[e]=t},o=function(e){var t={};class n{constructor(e="keyval-store",t="keyval"){this.storeName=t,this._dbp=new Promise((n,o)=>{const r=indexedDB.open(e,1);r.onerror=(()=>o(r.error)),r.onsuccess=(()=>n(r.result)),r.onupgradeneeded=(()=>{r.result.createObjectStore(t)})})}_withIDBStore(e,t){return this._dbp.then(n=>new Promise((o,r)=>{const i=n.transaction(this.storeName,e);i.oncomplete=(()=>o()),i.onabort=i.onerror=(()=>r(i.error)),t(i.objectStore(this.storeName))}))}}let o;function r(){return o||(o=new n),o}t.keys=function(e=r()){const t=[];return e._withIDBStore("readonly",e=>{(e.openKeyCursor||e.openCursor).call(e).onsuccess=function(){this.result&&(t.push(this.result.key),this.result.continue())}}).then(()=>t)},t.clear=function(e=r()){return e._withIDBStore("readwrite",e=>{e.clear()})},t.del=function(e,t=r()){return t._withIDBStore("readwrite",t=>{t.delete(e)})},t.set=function(e,t,n=r()){return n._withIDBStore("readwrite",n=>{n.put(t,e)})},t.get=function(e,t=r()){let n;return t._withIDBStore("readonly",t=>{n=t.get(e)}).then(()=>n.result)},t.Store=n;var i={};Object.defineProperty(i,"__esModule",{value:!0});var a=function(e){return new s(e.root,e.width)};i.DuplicateDPRScreen=a;class s{constructor(e,t,n=1.4,o=!0){this.root=e,this.width=t,this.aspectRatio=n,this.fillViewport=o,this.resize(),window.addEventListener("resize",()=>this.resize())}detach(){return this.cvs.parentNode&&this.root.removeChild(this.cvs),this}resize(){let e=!1;this.cvs&&!this.cvs.parentNode&&(e=!0),this.cvs&&this.detach();const t=this.aspectRatio,n=window.innerWidth,o=window.innerHeight,r=o>n&&o/n>=t;this.height=r?o*(this.width/n):this.width*t;const i=this.cvs=document.createElement("canvas"),a=i.getContext("2d");if(!a){const e="Could not initiate canvas context!";throw alert(e),new Error(e)}this.ctx=a,i.style.margin="0 auto",i.style.display="block",i.width=this.width,i.height=this.height,this.root.appendChild(i);const s=i.getBoundingClientRect(),c=window.devicePixelRatio||1;this.dpr=c,i.width=s.width*c,i.height=s.height*c,a.scale(c,c),this.fillViewport&&(r?i.style.width="100%":i.style.height="100%");const l=i.parentNode&&"BODY"!==i.parentNode.nodeName?i.parentNode:null;l&&(l.style.margin="0 auto",l.style.display="block"),a.webkitImageSmoothingEnabled=!1,a.msImageSmoothingEnabled=!1,a.mozImageSmoothingEnabled=!1,a.imageSmoothingEnabled=!1,e&&this.detach()}drawFrom(e){this.ctx.drawImage(e.cvs,0,0,e.cvs.width,e.cvs.height,0,0,this.cvs.width/this.dpr,this.cvs.height/this.dpr)}}var c=s;i.DPRScreen=c;"sprites.e3899b5b.png";var l={};l={ghost_bat:{x:0,y:0,w:32,h:32},ghost_bun:{x:32,y:0,w:32,h:32},ghost_cat:{x:64,y:0,w:32,h:32},ghost_hungry:{x:96,y:0,w:32,h:32},ghost_ink:{x:0,y:32,w:32,h:32},ghost_jaws:{x:32,y:32,w:32,h:32},ghost_petrified:{x:64,y:32,w:32,h:32},ghost_plant:{x:96,y:32,w:32,h:32},loc_abandoned:{x:0,y:64,w:128,h:64},loc_pier:{x:0,y:128,w:128,h:64},loc_street:{x:0,y:192,w:128,h:64},loc_tarot:{x:0,y:256,w:128,h:64},pico8_font:{x:0,y:320,w:128,h:40}};var h={},d=h&&h.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((o=o.apply(e,t||[])).next())})};Object.defineProperty(h,"__esModule",{value:!0});var u=class{constructor(e){this.path=e}colorShift(e,t,n,o){return d(this,void 0,void 0,function*(){const r=document.createElement("canvas");r.width=this.img.width,r.height=this.img.height;const i=r.getContext("2d");i.drawImage(this.img,0,0);const a=i.getImageData(0,0,r.width,r.height),s=a.data;for(var c=0;c<s.length;c+=4)s[c+0]=e,s[c+1]=t,s[c+2]=n,s[c+3]=0!==s[c+3]?o:0;return i.putImageData(a,0,0),new Promise((e,t)=>{this.img.onload=e,this.img.onerror=t,this.img.src=r.toDataURL()})})}load(){return new Promise((e,t)=>{const n=document.createElement("img");n.onload=(()=>e(n)),n.onerror=(e=>t(e)),n.src=this.path}).then(e=>{this.img=e})}};h.SpriteSheet=u;var p,f,w={};Object.defineProperty(w,"__esModule",{value:!0}),g=f=w.SpriteScale||(p={},w.SpriteScale=p),g[g.ONE=1]="ONE",g[g.TWO=2]="TWO",g[g.THREE=3]="THREE",g[g.FOUR=4]="FOUR";var g;var m=class{constructor(e){this.dprScreen=e,this.backbuffer=a(e).detach()}drawImg(e,t,n,o,r,i,a,s=f.ONE){this.dprScreen.ctx.drawImage(e,t,n,o,r,i,a,o*Math.floor(s),r*Math.floor(s))}ghostGlitch(e,t,n,o,r=o/2){this.backbuffer.drawFrom(this.dprScreen);let i=e,a=t,s=n,c=o;const l=Math.floor(r),h=c/l;for(let e=0;e<l;e++){const t=Math.floor(h),n=Math.floor(Math.random()*s)||1,o=Math.floor(Math.random()*(s-n)),r=Math.floor(Math.random()*n-n),c=Math.floor(i+o),l=Math.floor(a+e*t),d=Math.floor(i+r),u=Math.floor(a+e*t);this.dprScreen.ctx.drawImage(this.backbuffer.cvs,c,l,n,t,d,u,n,t)}}};w.SpriteScreen=m;var v,y={},S=y&&y.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(y,"__esModule",{value:!0});const b=S("sprites.e3899b5b.png"),_=S(l),x=" !\"#$%&'()*+,-./0123456789:;<=>?@abcdefghijklmnopqrstuvwxyz[\\]^_`ABCDEFGHIJKLMNOPQRSTUVWXYZ{|}~âˆ†",M=4,E=5,O=16,I=_.pico8_font;var P;D=P=v||(v={},y.FontColor=v),D[D.WHITE=0]="WHITE",D[D.BLACK=1]="BLACK";var D;var R=class{constructor(e){this.sscreen=e,this.white=new h.SpriteSheet(b.default),this.black=new h.SpriteSheet(b.default)}load(){return Promise.all([this.white.load(),this.black.load()]).then(()=>this.black.colorShift(0,0,0,255))}measure(e,t=w.SpriteScale.ONE){const n=e.split("").reduce((e,n)=>e+M*t,0),o=E*t;return{w:n,h:o}}drawText(e,t,n,o=w.SpriteScale.ONE,r=P.BLACK){let i=e,a=t;const s=n.split("");for(let e=0;e<s.length;e++){const t=s[e];if(" "!==t){const e=x.indexOf(t),n=Math.floor(e/O),s=e%O,c=r===P.WHITE?this.white.img:this.black.img;this.sscreen.drawImg(c,I.x+s*(2*M),I.y+n*E,2*M,E,i,a,o)}i+=M*o}}};y.PicoFont=R;var T={},k=T&&T.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((o=o.apply(e,t||[])).next())})},N=T&&T.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(T,"__esModule",{value:!0});const A=N("sprites.e3899b5b.png"),B=N(l),L=new Map;L.set(B.ghost_bun,{problem:["I'm so fluffy and cuddly,","no one will ever be scared of me!"],answers:["Hug it","Love it","Yell at it","Back slowly away from it"],correct:3,responses:{right:["I scared you!?","AMAZING WILL YOU BE MY FRIEND?"],wrong:["Ugh please don't touch me."]}});const C={cols:1,rows:1,cells:[{ghost:B.ghost_bun,location:B.loc_pier}]},W={panels:[],tapActions:[],sincePrevTap:0,player:{geo:null,cell:null,saveData:{solvedLocations:[]}}};const j="lgsavedata";(function(){k(this,void 0,void 0,function*(){const e=new c(document.body,320),n=new w.SpriteScreen(e),o=new h.SpriteSheet(A.default),r=new R(n),i={running:!0,stop:()=>{i.running=!1},anim:()=>{i.running&&(W.sincePrevTap=Math.max(W.sincePrevTap-16,0),n.dprScreen.ctx.fillStyle="black",n.dprScreen.ctx.fillRect(0,0,n.dprScreen.width,n.dprScreen.height),function(e,t,n){let o=0;const r=t.measure(" ",w.SpriteScale.ONE).h,i=2*t.measure(" ",w.SpriteScale.TWO).h;for(let a=0;a<n.length;a++){const s=n[a],c=Array.isArray(s.content)?s.content.map(e=>t.measure(e,w.SpriteScale.TWO)).reduce((e,t)=>(e.w=Math.max(t.w,e.w),e.h+=t.h,e),{w:0,h:0}):{w:s.content.desc.w*s.content.scale,h:s.content.desc.h*s.content.scale},{ctx:l}=e.dprScreen,h=Math.min(c.w+2*r,e.dprScreen.width),d=Math.min(Math.max(c.h,i)+2*r,e.dprScreen.height);let u,p;void 0===s.computedX?(u=Math.floor((e.dprScreen.width-h)*Math.random()),s.computedX=u):u=s.computedX,void 0===s.computedY?(p=Math.max(o-Math.floor(d/2*Math.random()),0),s.computedY=p):p=s.computedY,l.fillStyle="rgba(0, 0, 0, 0.3)",l.fillRect(0,0,e.dprScreen.width,e.dprScreen.height);const f=u+r,g=p+r,m=h-1-2*r,y=d-2*r;if(l.fillStyle="blue",l.fillRect(u,p,h,d),l.fillStyle="blue",l.fillRect(f,g,m,y),Array.isArray(s.content)){let e=0;s.content.forEach(n=>{t.drawText(u+r,p+e+r,n,w.SpriteScale.TWO,v.WHITE),e+=t.measure(n,w.SpriteScale.TWO).h})}else{const{desc:t,scale:n}=s.content;e.drawImg(s.content.img,t.x,t.y,t.w,t.h,u+r,p+r,n)}if(s.ghostEffect){const t=m/8,n=y/4,o=f+m/4,r=g+y/4;e.ghostGlitch(o,r,t,n,5)}o=p+d}}(n,r,W.panels),requestAnimationFrame(i.anim))}};let a;i.anim(),document.addEventListener("keydown",e=>{"Escape"===e.key&&(i.stop(),console.log("stopped"))}),yield Promise.all([o.load(),r.load()]),W.panels.push({content:["Loaded immaterial photograms!"]}),W.panels.push({content:["Retrieving past lives..."]}),yield function(e){return k(this,void 0,void 0,function*(){const n=yield t.get(j);n&&(e.player.saveData=n)})}(W),console.log("loaded save data",W.player.saveData),W.panels.push({content:["OK!"]}),W.panels.push({content:["Acquiring spectral...","triangulation!"]});try{a=yield function(){return k(this,void 0,void 0,function*(){return new Promise((e,t)=>{navigator.geolocation.getCurrentPosition(e,t,{enableHighAccuracy:!0,timeout:3e4,maximumAge:1e4})})})}()}catch(e){return void W.panels.push({content:["Failed to acquire! Sorry."]})}if(W.player.geo=a,function(e,t){const n=20*e.cols,o=20*e.rows;if(!t.geo)return;const r=n*(180+t.geo.coords.longitude)/360,i=o*(90-t.geo.coords.latitude)/180,a=Math.floor(r/n*e.cols),s=Math.floor(i/o*e.rows)*e.cols+a;t.cell=s}(C,W.player),null!==W.player.cell){W.panels.push({content:["Acquired!"]});const e=C.cells[W.player.cell];yield function(e,t=300){return k(this,void 0,void 0,function*(){return new Promise((n,o)=>{setTimeout(()=>{e(),n()},t)})})}(()=>{},1e3);const t={content:{desc:e.location,img:o.img,scale:w.SpriteScale.TWO},tag:"loc",computedY:0};if(W.panels.push(t),W.tapActions.push(()=>{W.panels.push({content:['"Back at the place again..."']})}),W.player.saveData.solvedLocations.find(e=>e===W.player.cell));else{t.ghostEffect=!0;const n=L.get(e.ghost);console.log(n)}}const s=()=>{if(W.sincePrevTap>0)return;W.sincePrevTap=100;const e=W.tapActions.shift();e&&e()};n.dprScreen.cvs.addEventListener("touchstart",e=>{s()}),n.dprScreen.cvs.addEventListener("click",e=>{s()})})})(),document.addEventListener("touchmove",function(e){e.preventDefault()},{passive:!1}),"object"==typeof exports&&"undefined"!=typeof module?module.exports=T:"function"==typeof define&&define.amd&&define(function(){return T});return{"9B6d":T}}(),r.modules=o,r}();